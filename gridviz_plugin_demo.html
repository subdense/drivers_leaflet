<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Gridviz Demo</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet"></script>
  <script src="https://www.unpkg.com/leaflet-gridviz"></script>

  <script>
    const crs = L.CRS.EPSG3857; // Adjust if needed

    const map = new L.Map('map', {
      crs: crs,
      center: [50.00754, 19.98211],
      zoom: 5,
    });

    let gridvizLayer = new L.gridviz.GridvizLayer({
      proj: 'EPSG:3035',
      onLayerDidMountCallback: (gridvizMap) => {
        const dataset = new L.gridviz.MultiResolutionDataset(
          [1000, 2000, 5000, 10000, 20000, 50000, 100000],
          (resolution) =>
            new L.gridviz.TiledGrid(
              gridvizMap,
              'https://raw.githubusercontent.com/jgaffuri/tiledgrids/main/data/europe/population2/' + resolution + 'm/'
            )
        );

        const colorFunction = (cell, resolution) => {
          const density = (1000000 * cell.TOT_P_2021) / (resolution * resolution);
          if (density > 1500) return '#993404';
          else if (density > 600) return '#d95f0e';
          else if (density > 200) return '#fe9929';
          else if (density > 60) return '#fec44f';
          else if (density > 15) return '#fee391';
          else return '#ffffd4';
        };

        const style = new L.gridviz.ShapeColorSizeStyle({ color: colorFunction });

        gridvizMap.layers = [new L.gridviz.GridLayer(dataset, [style], { minPixelsPerCell: 5 })];

        gridvizLayer._canvas.style.opacity = 0.7;
      },
    });

    gridvizLayer.addTo(map);
  </script>
</body>
</html>
